stopWords = {
            "a":True,
            "able":True,
            "about":True,
            "above":True,
            "abst":True,
            "accordance":True,
            "according":True,
            "accordingly":True,
            "across":True,
            "act":True,
            "actually":True,
            "added":True,
            "adj":True,
            "affected":True,
            "affecting":True,
            "affects":True,
            "after":True,
            "afterwards":True,
            "again":True,
            "against":True,
            "ah":True,
            "all":True,
            "almost":True,
            "alone":True,
            "along":True,
            "already":True,
            "also":True,
            "although":True,
            "always":True,
            "am":True,
            "among":True,
            "amongst":True,
            "an":True,
            "and":True,
            "announce":True,
            "another":True,
            "any":True,
            "anybody":True,
            "anyhow":True,
            "anymore":True,
            "anyone":True,
            "anything":True,
            "anyway":True,
            "anyways":True,
            "anywhere":True,
            "apparently":True,
            "approximately":True,
            "are":True,
            "aren":True,
            "arent":True,
            "arise":True,
            "around":True,
            "as":True,
            "aside":True,
            "ask":True,
            "asking":True,
            "at":True,
            "auth":True,
            "available":True,
            "away":True,
            "awfully":True,
            "b":True,
            "back":True,
            "be":True,
            "became":True,
            "because":True,
            "become":True,
            "becomes":True,
            "becoming":True,
            "been":True,
            "before":True,
            "beforehand":True,
            "begin":True,
            "beginning":True,
            "beginnings":True,
            "begins":True,
            "behind":True,
            "being":True,
            "believe":True,
            "below":True,
            "beside":True,
            "besides":True,
            "between":True,
            "beyond":True,
            "biol":True,
            "both":True,
            "brief":True,
            "briefly":True,
            "but":True,
            "by":True,
            "c":True,
            "ca":True,
            "came":True,
            "can":True,
            "cannot":True,
            "can't":True,
            "cause":True,
            "causes":True,
            "certain":True,
            "certainly":True,
            "co":True,
            "com":True,
            "come":True,
            "comes":True,
            "contain":True,
            "containing":True,
            "contains":True,
            "could":True,
            "couldnt":True,
            "d":True,
            "date":True,
            "did":True,
            "didn't":True,
            "different":True,
            "do":True,
            "does":True,
            "doesn't":True,
            "doing":True,
            "done":True,
            "don't":True,
            "down":True,
            "downwards":True,
            "due":True,
            "during":True,
            "e":True,
            "each":True,
            "ed":True,
            "edu":True,
            "effect":True,
            "eg":True,
            "eight":True,
            "eighty":True,
            "either":True,
            "else":True,
            "elsewhere":True,
            "end":True,
            "ending":True,
            "enough":True,
            "especially":True,
            "et":True,
            "et-al":True,
            "etc":True,
            "even":True,
            "ever":True,
            "every":True,
            "everybody":True,
            "everyone":True,
            "everything":True,
            "everywhere":True,
            "ex":True,
            "except":True,
            "f":True,
            "far":True,
            "few":True,
            "ff":True,
            "fifth":True,
            "first":True,
            "five":True,
            "fix":True,
            "followed":True,
            "following":True,
            "follows":True,
            "for":True,
            "former":True,
            "formerly":True,
            "forth":True,
            "found":True,
            "four":True,
            "from":True,
            "further":True,
            "furthermore":True,
            "g":True,
            "gave":True,
            "get":True,
            "gets":True,
            "getting":True,
            "give":True,
            "given":True,
            "gives":True,
            "giving":True,
            "go":True,
            "goes":True,
            "gone":True,
            "got":True,
            "gotten":True,
            "h":True,
            "had":True,
            "happens":True,
            "hardly":True,
            "has":True,
            "hasn't":True,
            "have":True,
            "haven't":True,
            "having":True,
            "he":True,
            "hed":True,
            "hence":True,
            "her":True,
            "here":True,
            "hereafter":True,
            "hereby":True,
            "herein":True,
            "heres":True,
            "hereupon":True,
            "hers":True,
            "herself":True,
            "hes":True,
            "hi":True,
            "hid":True,
            "him":True,
            "himself":True,
            "his":True,
            "hither":True,
            "home":True,
            "how":True,
            "howbeit":True,
            "however":True,
            "hundred":True,
            "i":True,
            "id":True,
            "ie":True,
            "if":True,
            "i'll":True,
            "im":True,
            "immediate":True,
            "immediately":True,
            "importance":True,
            "important":True,
            "in":True,
            "inc":True,
            "indeed":True,
            "index":True,
            "information":True,
            "instead":True,
            "into":True,
            "invention":True,
            "inward":True,
            "is":True,
            "isn't":True,
            "it":True,
            "itd":True,
            "it'll":True,
            "its":True,
            "itself":True,
            "i've":True,
            "j":True,
            "just":True,
            "k":True,
            "keep":True,
            "keeps":True,
            "kept":True,
            "kg":True,
            "km":True,
            "know":True,
            "known":True,
            "knows":True,
            "l":True,
            "largely":True,
            "last":True,
            "lately":True,
            "later":True,
            "latter":True,
            "latterly":True,
            "least":True,
            "less":True,
            "lest":True,
            "let":True,
            "lets":True,
            "like":True,
            "liked":True,
            "likely":True,
            "line":True,
            "little":True,
            "'ll":True,
            "look":True,
            "looking":True,
            "looks":True,
            "ltd":True,
            "m":True,
            "made":True,
            "mainly":True,
            "make":True,
            "makes":True,
            "many":True,
            "may":True,
            "maybe":True,
            "me":True,
            "mean":True,
            "means":True,
            "meantime":True,
            "meanwhile":True,
            "merely":True,
            "mg":True,
            "might":True,
            "million":True,
            "miss":True,
            "ml":True,
            "more":True,
            "moreover":True,
            "most":True,
            "mostly":True,
            "mr":True,
            "mrs":True,
            "much":True,
            "mug":True,
            "must":True,
            "my":True,
            "myself":True,
            "n":True,
            "na":True,
            "name":True,
            "namely":True,
            "nay":True,
            "nd":True,
            "near":True,
            "nearly":True,
            "necessarily":True,
            "necessary":True,
            "need":True,
            "needs":True,
            "neither":True,
            "never":True,
            "nevertheless":True,
            "new":True,
            "next":True,
            "nine":True,
            "ninety":True,
            "no":True,
            "nobody":True,
            "non":True,
            "none":True,
            "nonetheless":True,
            "noone":True,
            "nor":True,
            "normally":True,
            "nos":True,
            "not":True,
            "noted":True,
            "nothing":True,
            "now":True,
            "nowhere":True,
            "o":True,
            "obtain":True,
            "obtained":True,
            "obviously":True,
            "of":True,
            "off":True,
            "often":True,
            "oh":True,
            "ok":True,
            "okay":True,
            "old":True,
            "omitted":True,
            "on":True,
            "once":True,
            "one":True,
            "ones":True,
            "only":True,
            "onto":True,
            "or":True,
            "ord":True,
            "other":True,
            "others":True,
            "otherwise":True,
            "ought":True,
            "our":True,
            "ours":True,
            "ourselves":True,
            "out":True,
            "outside":True,
            "over":True,
            "overall":True,
            "owing":True,
            "own":True,
            "p":True,
            "page":True,
            "pages":True,
            "part":True,
            "particular":True,
            "particularly":True,
            "past":True,
            "per":True,
            "perhaps":True,
            "placed":True,
            "please":True,
            "plus":True,
            "poorly":True,
            "possible":True,
            "possibly":True,
            "potentially":True,
            "pp":True,
            "predominantly":True,
            "present":True,
            "previously":True,
            "primarily":True,
            "probably":True,
            "promptly":True,
            "proud":True,
            "provides":True,
            "put":True,
            "q":True,
            "que":True,
            "quickly":True,
            "quite":True,
            "qv":True,
            "r":True,
            "ran":True,
            "rather":True,
            "rd":True,
            "re":True,
            "readily":True,
            "really":True,
            "recent":True,
            "recently":True,
            "ref":True,
            "refs":True,
            "regarding":True,
            "regardless":True,
            "regards":True,
            "related":True,
            "relatively":True,
            "research":True,
            "respectively":True,
            "resulted":True,
            "resulting":True,
            "results":True,
            "right":True,
            "run":True,
            "s":True,
            "said":True,
            "same":True,
            "saw":True,
            "say":True,
            "saying":True,
            "says":True,
            "sec":True,
            "section":True,
            "see":True,
            "seeing":True,
            "seem":True,
            "seemed":True,
            "seeming":True,
            "seems":True,
            "seen":True,
            "self":True,
            "selves":True,
            "sent":True,
            "seven":True,
            "several":True,
            "shall":True,
            "she":True,
            "shed":True,
            "she'll":True,
            "shes":True,
            "should":True,
            "shouldn't":True,
            "show":True,
            "showed":True,
            "shown":True,
            "showns":True,
            "shows":True,
            "significant":True,
            "significantly":True,
            "similar":True,
            "similarly":True,
            "since":True,
            "six":True,
            "slightly":True,
            "so":True,
            "some":True,
            "somebody":True,
            "somehow":True,
            "someone":True,
            "somethan":True,
            "something":True,
            "sometime":True,
            "sometimes":True,
            "somewhat":True,
            "somewhere":True,
            "soon":True,
            "sorry":True,
            "specifically":True,
            "specified":True,
            "specify":True,
            "specifying":True,
            "still":True,
            "stop":True,
            "strongly":True,
            "sub":True,
            "substantially":True,
            "successfully":True,
            "such":True,
            "sufficiently":True,
            "suggest":True,
            "sup":True,
            "sure":True,
            "t":True,
            "take":True,
            "taken":True,
            "taking":True,
            "tell":True,
            "tends":True,
            "th":True,
            "than":True,
            "thank":True,
            "thanks":True,
            "thanx":True,
            "that":True,
            "that'll":True,
            "thats":True,
            "that've":True,
            "the":True,
            "their":True,
            "theirs":True,
            "them":True,
            "themselves":True,
            "then":True,
            "thence":True,
            "there":True,
            "thereafter":True,
            "thereby":True,
            "thered":True,
            "therefore":True,
            "therein":True,
            "there'll":True,
            "thereof":True,
            "therere":True,
            "theres":True,
            "thereto":True,
            "thereupon":True,
            "there've":True,
            "these":True,
            "they":True,
            "theyd":True,
            "they'll":True,
            "theyre":True,
            "they've":True,
            "think":True,
            "this":True,
            "those":True,
            "thou":True,
            "though":True,
            "thoughh":True,
            "thousand":True,
            "throug":True,
            "through":True,
            "throughout":True,
            "thru":True,
            "thus":True,
            "til":True,
            "tip":True,
            "to":True,
            "together":True,
            "too":True,
            "took":True,
            "toward":True,
            "towards":True,
            "tried":True,
            "tries":True,
            "truly":True,
            "try":True,
            "trying":True,
            "ts":True,
            "twice":True,
            "two":True,
            "u":True,
            "un":True,
            "under":True,
            "unfortunately":True,
            "unless":True,
            "unlike":True,
            "unlikely":True,
            "until":True,
            "unto":True,
            "up":True,
            "upon":True,
            "ups":True,
            "us":True,
            "use":True,
            "used":True,
            "useful":True,
            "usefully":True,
            "usefulness":True,
            "uses":True,
            "using":True,
            "usually":True,
            "v":True,
            "value":True,
            "various":True,
            "'ve":True,
            "very":True,
            "via":True,
            "viz":True,
            "vol":True,
            "vols":True,
            "vs":True,
            "w":True,
            "want":True,
            "wants":True,
            "was":True,
            "wasnt":True,
            "way":True,
            "we":True,
            "wed":True,
            "welcome":True,
            "we'll":True,
            "went":True,
            "were":True,
            "werent":True,
            "we've":True,
            "what":True,
            "whatever":True,
            "what'll":True,
            "whats":True,
            "when":True,
            "whence":True,
            "whenever":True,
            "where":True,
            "whereafter":True,
            "whereas":True,
            "whereby":True,
            "wherein":True,
            "wheres":True,
            "whereupon":True,
            "wherever":True,
            "whether":True,
            "which":True,
            "while":True,
            "whim":True,
            "whither":True,
            "who":True,
            "whod":True,
            "whoever":True,
            "whole":True,
            "who'll":True,
            "whom":True,
            "whomever":True,
            "whos":True,
            "whose":True,
            "why":True,
            "widely":True,
            "willing":True,
            "wish":True,
            "with":True,
            "within":True,
            "without":True,
            "wont":True,
            "words":True,
            "world":True,
            "would":True,
            "wouldnt":True,
            "www":True,
            "x":True,
            "y":True,
            "yes":True,
            "yet":True,
            "you":True,
            "youd":True,
            "you'll":True,
            "your":True,
            "youre":True,
            "yours":True,
            "yourself":True,
            "yourselves":True,
            "you've":True,
            "z":True,
            "zero":True  
      }

morewords="""
      a's   able  about above according
      accordingly across      actually    after afterwards
      again against     ain't all   allow
      allows      almost      alone along already
      also  although    always      am    among
      amongst     an    and   another     any
      anybody     anyhow      anyone      anything    anyway
      anyways     anywhere    apart appear      appreciate
      appropriate are   aren't      around      as
      aside ask   asking      associated  at
      available   away  awfully     be    became
      because     become      becomes     becoming    been
      before      beforehand  behind      being believe
      below beside      besides     best  better
      between     beyond      both  brief but
      by    c'mon c's   came  can
      can't cannot      cant  cause causes
      certain     certainly   changes     clearly     co
      com   come  comes concerning  consequently
      consider    considering contain     containing  contains
      corresponding     could couldn't    course      currently
      definitely  described   despite     did   didn't
      different   do    does  doesn't     doing
      don't done  down  downwards   during
      each  edu   eg    eight either
      else  elsewhere   enough      entirely    especially
      et    etc   even  ever  every
      everybody   everyone    everything  everywhere  ex
      exactly     example     except      far   few
      fifth first five  followed    following
      follows     for   former      formerly    forth
      four  from  further     furthermore get
      gets  getting     given gives go
      goes  going gone  got   gotten
      greetings   had   hadn't      happens     hardly
      has   hasn't      have  haven't     having
      he    he's  hello help  hence
      her   here  here's      hereafter   hereby
      herein      hereupon    hers  herself     hi
      him   himself     his   hither      hopefully
      how   howbeit     however     i'd   i'll
      i'm   i've  ie    if    ignored
      immediate   in    inasmuch    inc   indeed
      indicate    indicated   indicates   inner insofar
      instead     into  inward      is    isn't
      it    it'd  it'll it's  its
      itself      just  keep  keeps kept
      know  known knows last  lately
      later latter      latterly    least less
      lest  let   let's like  liked
      likely      little      look  looking     looks
      ltd   mainly      many  may   maybe
      me    mean  meanwhile   merely      might
      more  moreover    most  mostly      much
      must  my    myself      name  namely
      nd    near  nearly      necessary   need
      needs neither     never nevertheless      new
      next  nine  no    nobody      non
      none  noone nor   normally    not
      nothing     novel now   nowhere     obviously
      of    off   often oh    ok
      okay  old   on    once  one
      ones  only  onto  or    other
      others      otherwise   ought our   ours
      ourselves   out   outside     over  overall
      own   particular  particularly      per   perhaps
      placed      please      plus  possible    presumably
      probably    provides    que   quite qv
      rather      rd    re    really      reasonably
      regarding   regardless  regards     relatively  respectively
      right said  same  saw   say
      saying      says  second      secondly    see
      seeing      seem  seemed      seeming     seems
      seen  self  selves      sensible    sent
      serious     seriously   seven several     shall
      she   should      shouldn't   since six
      so    some  somebody    somehow     someone
      something   sometime    sometimes   somewhat    somewhere
      soon  sorry specified   specify     specifying
      still sub   such  sup   sure
      t's   take  taken tell  tends
      th    than  thank thanks      thanx
      that  that's      thats the   their
      theirs      them  themselves  then  thence
      there there's     thereafter  thereby     therefore
      therein     theres      thereupon   these they
      they'd      they'll     they're     they've     think
      third this  thorough    thoroughly  those
      though      three through     throughout  thru
      thus  to    together    too   took
      toward      towards     tried tries truly
      try   trying      twice two   un
      under unfortunately     unless      unlikely    until
      unto  up    upon  us    use
      used  useful      uses  using usually
      value various     very  via   viz
      vs    want  wants was   wasn't
      way   we    we'd  we'll we're
      we've welcome     well  went  were
      weren't     what  what's      whatever    when
      whence      whenever    where where's     whereafter
      whereas     whereby     wherein     whereupon   wherever
      whether     which while whither     who
      who's whoever     whole whom  whose
      why   will  willing     wish  with
      within      without     won't wonder      would
      wouldn't    yes   yet   you   you'd
      you'll      you're      you've      your  yours
      yourself    yourselves  zero
      """
words=morewords.split()
from nltk import word_tokenize
for word in words:
      stopWords[word]=True
print len(stopWords)



allTopics = [ 'shopping','football']



import sqlite3
from collections import defaultdict
import threading

dsn = "/mnt/parantapa-data/reddit-comments/reddit-comments.sqlite3"




thread_list=[]
import codecs

def writetofile(topic):
      con = sqlite3.connect(dsn)
      con.row_factory = sqlite3.Row
      cur = con.cursor()
      subreddit=topic.lower()
      print 'computing for',subreddit
      sql = """
              select body
              from comment
              where subreddit = ? collate nocase limit 100000
              """
      cur.execute(sql, [subreddit])
      rows=cur.fetchall()

      data=defaultdict(lambda:0)
      for row in rows:
            text=row[0]
            if text is not None:
                  text=text.lower()
                  words= word_tokenize(text)
                  for word in words:
                        if word not in stopWords and word.isalpha():
                              data[word]+=1

      data=data.items()

      data=sorted(data,key=lambda tup: tup[1])

      # print data
      with  codecs.open(subreddit,'w','utf-8') as o:
            for d in data[-1000:]:
                  o.write(d[0]+" "+str(d[1])+"\n")



if __name__=='__main__':
      print 'hello'
      for topic in allTopics:
          t = threading.Thread(target=writetofile, args=(topic,))
          thread_list.append(t)

      print(len(thread_list))
      
      for thread in thread_list:
            thread.start()
      for thread in thread_list:
            thread.join()

      # Demonstrates that the main process waited for threads to complete
      print "Done"
